import unittest
import os.path as op
import inspect
import pandas as pd
import numpy as np
import warnings

import tcrdist as td
from tcrdist.repertoire import TCRrep
from tcrdist.proximity import TCRproximity

class test_proximity(unittest.TestCase):
    def test_proximity_with_data(self):

        cells_df_dict = {'cdr3_a_aa': {2269: 'CAYSVNAGGTSYGKLTF', 814: 'CALRCFGNEKLTF', 815: 'CALRCFGNEKLTF', 1335: 'CASDNNARLMF',
                           532: 'CAGATGGSQGNLIF', 468: 'CAEYSSAFKIIF', 469: 'CAEYSSASKIIF', 497: 'CAGAGGGSQGNLIF',
                           2438: 'CVVSGDDTGNQFYF', 806: 'CALPMNRDDKIIF', 455: 'CAESKGNLIF', 2280: 'CILGMDSSYKLIF',
                           649: 'CALDMGGGSQGNLIF', 507: 'CAGAGGGSQGNLIF', 1553: 'CAVNLNEKLTF', 518: 'CAGALTGYGGSQGNLIF',
                           438: 'CAELGNDMRF', 545: 'CAGEGGGSQGNLIF', 1762: 'CAVSDDNDMRF', 496: 'CAGAGDNTGKLIF',
                           489: 'CAGADGGSQGNLIF', 1363: 'CATDALGNGNEKLTF', 412: 'CAEDNNARLMF', 1574: 'CAVPNTNAGKSTF',
                           598: 'CAGTGFQKLVF', 2204: 'CAVSVRMDSSYKLIF', 538: 'CAGAVGSSNTGKLIF', 463: 'CAESTGKLIF',
                           1504: 'CAVGEDSSYKLIF', 555: 'CAGGGSQGNLIF', 2260: 'CAVYSNSGYALNF', 1492: 'CAVDGGGGSQGNLIF',
                           167: 'CAASDGAGGTSYGKLTF', 67: 'CAAISDYKLSF', 410: 'CAEDNNARLMF', 540: 'CAGDLVIYGGSQGNLIF'},
             'cdr3_b_aa': {2269: 'CASSIGTYGYTF', 814: 'CSVPGTVQETQYF', 815: 'CSVPITVQETQYF', 1335: 'CSARDSTGNGYTF',
                           532: 'CASSIRSDYEQYF', 468: 'CASSQSPGGTQYF', 469: 'CASSQSPGGTQYF', 497: 'CASSFRSTDTQYF',
                           2438: 'CASSLTLVFEAFF', 806: 'CASSYAYDGSYEQYF', 455: 'CASSQSPGGEQYF', 2280: 'CSVPGLAVPGELFF',
                           649: 'CASSIRAADTQYF', 507: 'CASSIRSGYEQYF', 1553: 'CSARDGTRAHYEQFF', 518: 'CASSIRSSYEQYF',
                           438: 'CASSQSPGGEQYF', 545: 'CASSIRSSYEQYF', 1762: 'CASSQTYEQYF', 496: 'CASSVRSSYEQYF',
                           489: 'CASSGRSTDTQYF', 1363: 'CATQGDNTYEQYF', 412: 'CSARDSTGNGYTF', 1574: 'CASSSRSGNEKLFF',
                           598: 'CASSLGDRPSTDTQYF', 2204: 'CASSQDPGYEQYF', 538: 'CASSIRSAYEQYF', 463: 'CSVGTGGTNEKLFF',
                           1504: 'CSAEPETSGGLQYF', 555: 'CASSIRSSYEQYF', 2260: 'CSVGTGGTNEKLFF', 1492: 'CASSIRSSYEQYF',
                           167: 'CASSLWTGSHEQYF', 67: 'CASSIRSSYEQYF', 410: 'CSARDRTGNGYTF', 540: 'CASSIRSSYEQYF'},
             'cell_type': {2269: 'CD8+', 814: 'CD8+', 815: 'CD8+', 1335: 'CD8+', 532: 'CD8+', 468: 'CD8+', 469: 'CD8+',
                           497: 'CD8+', 2438: 'CD8+', 806: 'CD8+', 455: 'CD8+', 2280: 'CD8+', 649: 'CD8+', 507: 'CD8+',
                           1553: 'CD8+', 518: 'CD8+', 438: 'CD8+', 545: 'CD8+', 1762: 'CD8+', 496: 'CD8+', 489: 'CD8+',
                           1363: 'CD8+', 412: 'CD8+', 1574: 'CD8+', 598: 'CD8+', 2204: 'CD8+', 538: 'CD8+', 463: 'CD8+',
                           1504: 'CD8+', 555: 'CD8+', 2260: 'CD8+', 1492: 'CD8+', 167: 'CD8+', 67: 'CD8+', 410: 'CD8+',
                           540: 'CD8+'},
             'count': {2269: 1, 814: 2, 815: 30, 1335: 11, 532: 1, 468: 1, 469: 5, 497: 3, 2438: 1, 806: 1, 455: 1, 2280: 4,
                       649: 1, 507: 2, 1553: 1, 518: 1, 438: 8, 545: 2, 1762: 1, 496: 1, 489: 1, 1363: 1, 412: 14, 1574: 1,
                       598: 1, 2204: 1, 538: 1, 463: 62, 1504: 1, 555: 6, 2260: 1, 1492: 1, 167: 1, 67: 1, 410: 1, 540: 1},
             'epitope': {2269: 'M1', 814: 'BMLF', 815: 'BMLF', 1335: 'BMLF', 532: 'M1', 468: 'BMLF', 469: 'BMLF', 497: 'M1',
                         2438: 'M1', 806: 'BMLF', 455: 'BMLF', 2280: 'BMLF', 649: 'M1', 507: 'M1', 1553: 'M1', 518: 'M1',
                         438: 'BMLF', 545: 'M1', 1762: 'M1', 496: 'M1', 489: 'M1', 1363: 'M1', 412: 'BMLF', 1574: 'M1',
                         598: 'M1', 2204: 'M1', 538: 'M1', 463: 'BMLF', 1504: 'BMLF', 555: 'M1', 2260: 'BMLF', 1492: 'M1',
                         167: 'BMLF', 67: 'M1', 410: 'BMLF', 540: 'M1'},
             'epitope_aa': {2269: 'GILGFVFTL', 814: 'GLCTLVAML', 815: 'GLCTLVAML', 1335: 'GLCTLVAML', 532: 'GILGFVFTL',
                            468: 'GLCTLVAML', 469: 'GLCTLVAML', 497: 'GILGFVFTL', 2438: 'GILGFVFTL', 806: 'GLCTLVAML',
                            455: 'GLCTLVAML', 2280: 'GLCTLVAML', 649: 'GILGFVFTL', 507: 'GILGFVFTL', 1553: 'GILGFVFTL',
                            518: 'GILGFVFTL', 438: 'GLCTLVAML', 545: 'GILGFVFTL', 1762: 'GILGFVFTL', 496: 'GILGFVFTL',
                            489: 'GILGFVFTL', 1363: 'GILGFVFTL', 412: 'GLCTLVAML', 1574: 'GILGFVFTL', 598: 'GILGFVFTL',
                            2204: 'GILGFVFTL', 538: 'GILGFVFTL', 463: 'GLCTLVAML', 1504: 'GLCTLVAML', 555: 'GILGFVFTL',
                            2260: 'GLCTLVAML', 1492: 'GILGFVFTL', 167: 'GLCTLVAML', 67: 'GILGFVFTL', 410: 'GLCTLVAML',
                            540: 'GILGFVFTL'},
             'frequency': {2269: '1/34', 814: '2/129', 815: '30/129', 1335: '11/65', 532: '1/57', 468: '1/53', 469: '5/53',
                           497: '3/27', 2438: '1/52', 806: '1/45', 455: '1/53', 2280: '4/129', 649: '1/34', 507: '2/52',
                           1553: '1/18', 518: '1/52', 438: '8/160', 545: '2/57', 1762: '1/27', 496: '1/34', 489: '1/27',
                           1363: '1/18', 412: '14/129', 1574: '1/24', 598: '1/52', 2204: '1/18', 538: '1/52', 463: '62/160',
                           1504: '1/45', 555: '6/55', 2260: '1/160', 1492: '1/57', 167: '1/53', 67: '1/52', 410: '1/45',
                           540: '1/25'},
             'id': {2269: 2988, 814: 1479, 815: 1480, 1335: 2016, 532: 1192, 468: 1128, 469: 1129, 497: 1157, 2438: 3159,
                    806: 1471, 455: 1115, 2280: 2999, 649: 1312, 507: 1167, 1553: 2244, 518: 1178, 438: 1097, 545: 1205,
                    1762: 2464, 496: 1156, 489: 1149, 1363: 2047, 412: 1071, 1574: 2269, 598: 1258, 2204: 2922, 538: 1198,
                    463: 1123, 1504: 2192, 555: 1215, 2260: 2978, 1492: 2179, 167: 814, 67: 702, 410: 1069, 540: 1200},
             'j_a_gene': {2269: 'TRAJ52*01', 814: 'TRAJ48*01', 815: 'TRAJ48*01', 1335: 'TRAJ31*01', 532: 'TRAJ42*01',
                          468: 'TRAJ3*01', 469: 'TRAJ3*01', 497: 'TRAJ42*01', 2438: 'TRAJ49*01', 806: 'TRAJ30*01',
                          455: 'TRAJ42*01', 2280: 'TRAJ12*01', 649: 'TRAJ42*01', 507: 'TRAJ42*01', 1553: 'TRAJ48*01',
                          518: 'TRAJ42*01', 438: 'TRAJ43*01', 545: 'TRAJ42*01', 1762: 'TRAJ43*01', 496: 'TRAJ37*01',
                          489: 'TRAJ42*01', 1363: 'TRAJ48*01', 412: 'TRAJ31*01', 1574: 'TRAJ27*01', 598: 'TRAJ8*01',
                          2204: 'TRAJ12*01', 538: 'TRAJ37*01', 463: 'TRAJ37*01', 1504: 'TRAJ12*01', 555: 'TRAJ42*01',
                          2260: 'TRAJ41*01', 1492: 'TRAJ42*01', 167: 'TRAJ52*01', 67: 'TRAJ20*01', 410: 'TRAJ31*01',
                          540: 'TRAJ42*01'},
             'j_b_gene': {2269: 'TRBJ1-2*01', 814: 'TRBJ2-5*01', 815: 'TRBJ2-5*01', 1335: 'TRBJ1-2*01', 532: 'TRBJ2-7*01',
                          468: 'TRBJ2-3*01', 469: 'TRBJ2-3*01', 497: 'TRBJ2-3*01', 2438: 'TRBJ1-1*01', 806: 'TRBJ2-7*01',
                          455: 'TRBJ2-7*01', 2280: 'TRBJ2-2*01', 649: 'TRBJ2-3*01', 507: 'TRBJ2-7*01', 1553: 'TRBJ2-1*01',
                          518: 'TRBJ2-7*01', 438: 'TRBJ2-7*01', 545: 'TRBJ2-7*01', 1762: 'TRBJ2-7*01', 496: 'TRBJ2-7*01',
                          489: 'TRBJ2-3*01', 1363: 'TRBJ2-7*01', 412: 'TRBJ1-2*01', 1574: 'TRBJ1-4*01', 598: 'TRBJ2-3*01',
                          2204: 'TRBJ2-7*01', 538: 'TRBJ2-7*01', 463: 'TRBJ1-4*01', 1504: 'TRBJ2-4*01', 555: 'TRBJ2-7*01',
                          2260: 'TRBJ1-4*01', 1492: 'TRBJ2-7*01', 167: 'TRBJ2-7*01', 67: 'TRBJ2-7*01', 410: 'TRBJ1-2*01',
                          540: 'TRBJ2-7*01'},
             'mhc_a_a': {2269: 'HLA-A*02:01', 814: 'HLA-A*02:01', 815: 'HLA-A*02:01', 1335: 'HLA-A*02:01',
                         532: 'HLA-A*02:01', 468: 'HLA-A*02:01', 469: 'HLA-A*02:01', 497: 'HLA-A*02:01',
                         2438: 'HLA-A*02:01', 806: 'HLA-A*02:01', 455: 'HLA-A*02:01', 2280: 'HLA-A*02:01',
                         649: 'HLA-A*02:01', 507: 'HLA-A*02:01', 1553: 'HLA-A*02:01', 518: 'HLA-A*02:01',
                         438: 'HLA-A*02:01', 545: 'HLA-A*02:01', 1762: 'HLA-A*02:01', 496: 'HLA-A*02:01',
                         489: 'HLA-A*02:01', 1363: 'HLA-A*02:01', 412: 'HLA-A*02:01', 1574: 'HLA-A*02:01',
                         598: 'HLA-A*02:01', 2204: 'HLA-A*02:01', 538: 'HLA-A*02:01', 463: 'HLA-A*02:01',
                         1504: 'HLA-A*02:01', 555: 'HLA-A*02:01', 2260: 'HLA-A*02:01', 1492: 'HLA-A*02:01',
                         167: 'HLA-A*02:01', 67: 'HLA-A*02:01', 410: 'HLA-A*02:01', 540: 'HLA-A*02:01'},
             'mhc_a_b': {2269: 'B2M', 814: 'B2M', 815: 'B2M', 1335: 'B2M', 532: 'B2M', 468: 'B2M', 469: 'B2M', 497: 'B2M',
                         2438: 'B2M', 806: 'B2M', 455: 'B2M', 2280: 'B2M', 649: 'B2M', 507: 'B2M', 1553: 'B2M', 518: 'B2M',
                         438: 'B2M', 545: 'B2M', 1762: 'B2M', 496: 'B2M', 489: 'B2M', 1363: 'B2M', 412: 'B2M', 1574: 'B2M',
                         598: 'B2M', 2204: 'B2M', 538: 'B2M', 463: 'B2M', 1504: 'B2M', 555: 'B2M', 2260: 'B2M', 1492: 'B2M',
                         167: 'B2M', 67: 'B2M', 410: 'B2M', 540: 'B2M'},
             'mhc_b_a': {2269: 'HLA-A*02:01', 814: 'HLA-A*02:01', 815: 'HLA-A*02:01', 1335: 'HLA-A*02:01',
                         532: 'HLA-A*02:01', 468: 'HLA-A*02:01', 469: 'HLA-A*02:01', 497: 'HLA-A*02:01',
                         2438: 'HLA-A*02:01', 806: 'HLA-A*02:01', 455: 'HLA-A*02:01', 2280: 'HLA-A*02:01',
                         649: 'HLA-A*02:01', 507: 'HLA-A*02:01', 1553: 'HLA-A*02:01', 518: 'HLA-A*02:01',
                         438: 'HLA-A*02:01', 545: 'HLA-A*02:01', 1762: 'HLA-A*02:01', 496: 'HLA-A*02:01',
                         489: 'HLA-A*02:01', 1363: 'HLA-A*02:01', 412: 'HLA-A*02:01', 1574: 'HLA-A*02:01',
                         598: 'HLA-A*02:01', 2204: 'HLA-A*02:01', 538: 'HLA-A*02:01', 463: 'HLA-A*02:01',
                         1504: 'HLA-A*02:01', 555: 'HLA-A*02:01', 2260: 'HLA-A*02:01', 1492: 'HLA-A*02:01',
                         167: 'HLA-A*02:01', 67: 'HLA-A*02:01', 410: 'HLA-A*02:01', 540: 'HLA-A*02:01'},
             'mhc_b_b': {2269: 'B2M', 814: 'B2M', 815: 'B2M', 1335: 'B2M', 532: 'B2M', 468: 'B2M', 469: 'B2M', 497: 'B2M',
                         2438: 'B2M', 806: 'B2M', 455: 'B2M', 2280: 'B2M', 649: 'B2M', 507: 'B2M', 1553: 'B2M', 518: 'B2M',
                         438: 'B2M', 545: 'B2M', 1762: 'B2M', 496: 'B2M', 489: 'B2M', 1363: 'B2M', 412: 'B2M', 1574: 'B2M',
                         598: 'B2M', 2204: 'B2M', 538: 'B2M', 463: 'B2M', 1504: 'B2M', 555: 'B2M', 2260: 'B2M', 1492: 'B2M',
                         167: 'B2M', 67: 'B2M', 410: 'B2M', 540: 'B2M'},
             'organism': {2269: 'HomoSapiens', 814: 'HomoSapiens', 815: 'HomoSapiens', 1335: 'HomoSapiens',
                          532: 'HomoSapiens', 468: 'HomoSapiens', 469: 'HomoSapiens', 497: 'HomoSapiens',
                          2438: 'HomoSapiens', 806: 'HomoSapiens', 455: 'HomoSapiens', 2280: 'HomoSapiens',
                          649: 'HomoSapiens', 507: 'HomoSapiens', 1553: 'HomoSapiens', 518: 'HomoSapiens',
                          438: 'HomoSapiens', 545: 'HomoSapiens', 1762: 'HomoSapiens', 496: 'HomoSapiens',
                          489: 'HomoSapiens', 1363: 'HomoSapiens', 412: 'HomoSapiens', 1574: 'HomoSapiens',
                          598: 'HomoSapiens', 2204: 'HomoSapiens', 538: 'HomoSapiens', 463: 'HomoSapiens',
                          1504: 'HomoSapiens', 555: 'HomoSapiens', 2260: 'HomoSapiens', 1492: 'HomoSapiens',
                          167: 'HomoSapiens', 67: 'HomoSapiens', 410: 'HomoSapiens', 540: 'HomoSapiens'},
             'subject': {2269: 'human_subject0015', 814: 'human_subject0004', 815: 'human_subject0004',
                         1335: 'human_subject0001', 532: 'human_subject0025', 468: 'human_subject0002',
                         469: 'human_subject0002', 497: 'human_subject0013', 2438: 'human_subject0028',
                         806: 'human_subject0005', 455: 'human_subject0002', 2280: 'human_subject0004',
                         649: 'human_subject0015', 507: 'human_subject0028', 1553: 'human_subject0026',
                         518: 'human_subject0028', 438: 'human_subject0006', 545: 'human_subject0025',
                         1762: 'human_subject0029', 496: 'human_subject0015', 489: 'human_subject0013',
                         1363: 'human_subject0026', 412: 'human_subject0004', 1574: 'human_subject0012',
                         598: 'human_subject0028', 2204: 'human_subject0026', 538: 'human_subject0028',
                         463: 'human_subject0006', 1504: 'human_subject0005', 555: 'human_subject0027',
                         2260: 'human_subject0006', 1492: 'human_subject0025', 167: 'human_subject0002',
                         67: 'human_subject0028', 410: 'human_subject0005', 540: 'human_subject0011'},
             'v_a_gene': {2269: 'TRAV38-2/DV8*01', 814: 'TRAV16*01', 815: 'TRAV16*01', 1335: 'TRAV5*01', 532: 'TRAV27*01',
                          468: 'TRAV5*01', 469: 'TRAV5*01', 497: 'TRAV27*01', 2438: 'TRAV8-2*01', 806: 'TRAV6*01',
                          455: 'TRAV5*01', 2280: 'TRAV26-2*01', 649: 'TRAV6*01', 507: 'TRAV27*01', 1553: 'TRAV3*01',
                          518: 'TRAV27*01', 438: 'TRAV5*01', 545: 'TRAV27*01', 1762: 'TRAV8-4*01', 496: 'TRAV27*01',
                          489: 'TRAV27*01', 1363: 'TRAV17*01', 412: 'TRAV5*01', 1574: 'TRAV21*01', 598: 'TRAV35*01',
                          2204: 'TRAV8-6*02', 538: 'TRAV27*01', 463: 'TRAV5*01', 1504: 'TRAV22*01', 555: 'TRAV27*01',
                          2260: 'TRAV21*01', 1492: 'TRAV22*01', 167: 'TRAV29/DV5*01', 67: 'TRAV29/DV5*01', 410: 'TRAV5*01',
                          540: 'TRAV27*01'},
             'v_b_gene': {2269: 'TRBV19*02', 814: 'TRBV29-1*01', 815: 'TRBV29-1*01', 1335: 'TRBV20-1*01', 532: 'TRBV19*01',
                          468: 'TRBV14*01', 469: 'TRBV14*01', 497: 'TRBV19*02', 2438: 'TRBV7-9*01', 806: 'TRBV11-2*01',
                          455: 'TRBV14*01', 2280: 'TRBV29-1*01', 649: 'TRBV19*02', 507: 'TRBV19*01', 1553: 'TRBV20-1*01',
                          518: 'TRBV19*01', 438: 'TRBV14*01', 545: 'TRBV19*01', 1762: 'TRBV12-4*01', 496: 'TRBV19*02',
                          489: 'TRBV19*01', 1363: 'TRBV19*01', 412: 'TRBV20-1*01', 1574: 'TRBV19*02', 598: 'TRBV12-4*01',
                          2204: 'TRBV4-1*01', 538: 'TRBV19*01', 463: 'TRBV29-1*01', 1504: 'TRBV20-1*01', 555: 'TRBV19*01',
                          2260: 'TRBV29-1*01', 1492: 'TRBV19*01', 167: 'TRBV5-8*01', 67: 'TRBV19*01', 410: 'TRBV20-1*01',
                          540: 'TRBV19*02'},
             'cdr1_a_aa': {2269: 'TSESDYY', 814: 'YSGSPE', 815: 'YSGSPE', 1335: 'DSSSTY', 532: 'SVFSS', 468: 'DSSSTY',
                           469: 'DSSSTY', 497: 'SVFSS', 2438: 'SSYSPS', 806: 'NYSPAY', 455: 'DSSSTY', 2280: 'TISGTDY',
                           649: 'NYSPAY', 507: 'SVFSS', 1553: 'VSGNPY', 518: 'SVFSS', 438: 'DSSSTY', 545: 'SVFSS',
                           1762: 'SSVPPY', 496: 'SVFSS', 489: 'SVFSS', 1363: 'TSINN', 412: 'DSSSTY', 1574: 'DSAIYN',
                           598: 'SIFNT', 2204: 'SSVSVY', 538: 'SVFSS', 463: 'DSSSTY', 1504: 'DSVNN', 555: 'SVFSS',
                           2260: 'DSAIYN', 1492: 'DSVNN', 167: 'NSMFDY', 67: 'NSMFDY', 410: 'DSSSTY', 540: 'SVFSS'},
             'cdr2_a_aa': {2269: 'QEAYKQQN', 814: 'HISR', 815: 'HISR', 1335: 'IFSNMDM', 532: 'VVTGGEV', 468: 'IFSNMDM',
                           469: 'IFSNMDM', 497: 'VVTGGEV', 2438: 'YTSAATLV', 806: 'IRENEKE', 455: 'IFSNMDM', 2280: 'GLTSN',
                           649: 'IRENEKE', 507: 'VVTGGEV', 1553: 'YITGDNLV', 518: 'VVTGGEV', 438: 'IFSNMDM', 545: 'VVTGGEV',
                           1762: 'YTSAATLV', 496: 'VVTGGEV', 489: 'VVTGGEV', 1363: 'IRSNERE', 412: 'IFSNMDM',
                           1574: 'IQSSQRE', 598: 'LYKAGEL', 2204: 'YLSGSTLV', 538: 'VVTGGEV', 463: 'IFSNMDM', 1504: 'IPSGT',
                           555: 'VVTGGEV', 2260: 'IQSSQRE', 1492: 'IPSGT', 167: 'ISSIKDK', 67: 'ISSIKDK', 410: 'IFSNMDM',
                           540: 'VVTGGEV'},
             'pmhc_a_aa': {2269: 'QKAAKS', 814: 'NKGETS', 815: 'NKGETS', 1335: 'NKKDKH', 532: 'GDARKD', 468: 'NKKDKH',
                           469: 'NKKDKH', 497: 'GDARKD', 2438: 'KKSETS', 806: 'DTTLKQ', 455: 'NKKDKH', 2280: 'AEDRKS',
                           649: 'DTTLKQ', 507: 'GDARKD', 1553: 'NKSQTS', 518: 'GDARKD', 438: 'NKKDKH', 545: 'GDARKD',
                           1762: 'KKSETS', 496: 'GDARKD', 489: 'GDARKD', 1363: 'DTSKKS', 412: 'NKKDKH', 1574: 'DKSSGR',
                           598: 'GITRKD', 2204: 'NKSQTS', 538: 'GDARKD', 463: 'NKKDKH', 1504: 'VATERY', 555: 'GDARKD',
                           2260: 'DKSSGR', 1492: 'VATERY', 167: 'NKSAKH', 67: 'NKSAKH', 410: 'NKKDKH', 540: 'GDARKD'},
             'cdr1_b_aa': {2269: 'LNHDA', 814: 'SQVTM', 815: 'SQVTM', 1335: 'DFQATT', 532: 'LNHDA', 468: 'SGHDN',
                           469: 'SGHDN', 497: 'LNHDA', 2438: 'SEHNR', 806: 'SGHAT', 455: 'SGHDN', 2280: 'SQVTM',
                           649: 'LNHDA', 507: 'LNHDA', 1553: 'DFQATT', 518: 'LNHDA', 438: 'SGHDN', 545: 'LNHDA',
                           1762: 'SGHDY', 496: 'LNHDA', 489: 'LNHDA', 1363: 'LNHDA', 412: 'DFQATT', 1574: 'LNHDA',
                           598: 'SGHDY', 2204: 'MGHRA', 538: 'LNHDA', 463: 'SQVTM', 1504: 'DFQATT', 555: 'LNHDA',
                           2260: 'SQVTM', 1492: 'LNHDA', 167: 'SGHTS', 67: 'LNHDA', 410: 'DFQATT', 540: 'LNHDA'},
             'cdr2_b_aa': {2269: 'SHIVND', 814: 'ANQGSEA', 815: 'ANQGSEA', 1335: 'SNEGSKA', 532: 'SQIVND', 468: 'FVKESK',
                           469: 'FVKESK', 497: 'SHIVND', 2438: 'FQNEAQ', 806: 'FQNNGV', 455: 'FVKESK', 2280: 'ANQGSEA',
                           649: 'SHIVND', 507: 'SQIVND', 1553: 'SNEGSKA', 518: 'SQIVND', 438: 'FVKESK', 545: 'SQIVND',
                           1762: 'FNNNVP', 496: 'SHIVND', 489: 'SQIVND', 1363: 'SQIVND', 412: 'SNEGSKA', 1574: 'SHIVND',
                           598: 'FNNNVP', 2204: 'YSYEKL', 538: 'SQIVND', 463: 'ANQGSEA', 1504: 'SNEGSKA', 555: 'SQIVND',
                           2260: 'ANQGSEA', 1492: 'SQIVND', 167: 'YDEGEE', 67: 'SQIVND', 410: 'SNEGSKA', 540: 'SHIVND'},
             'pmhc_b_aa': {2269: 'EKKES', 814: 'PNLTF', 815: 'PNLTF', 1335: 'ASLTL', 532: 'EKKES', 468: 'TGGTY',
                           469: 'TGGTY', 497: 'EKKES', 2438: 'PKGSF', 806: 'LKGVD', 455: 'TGGTY', 2280: 'PNLTF',
                           649: 'EKKES', 507: 'EKKES', 1553: 'ASLTL', 518: 'EKKES', 438: 'TGGTY', 545: 'EKKES',
                           1762: 'PNASF', 496: 'EKKES', 489: 'EKKES', 1363: 'EKKES', 412: 'ASLTL', 1574: 'EKKES',
                           598: 'PNASF', 2204: 'PNSSL', 538: 'EKKES', 463: 'PNLTF', 1504: 'ASLTL', 555: 'EKKES',
                           2260: 'PNLTF', 1492: 'EKKES', 167: 'FPNYS', 67: 'EKKES', 410: 'ASLTL', 540: 'EKKES'}}

        cells_df = pd.DataFrame(cells_df_dict)


        tr = TCRrep(cell_df=cells_df, organism='human')
        tr.infer_cdrs_from_v_gene(chain='alpha')
        tr.infer_cdrs_from_v_gene(chain='beta')
        tr.index_cols =['subject', 'cdr3_b_aa', 'epitope']
        tr.deduplicate()
        with warnings.catch_warnings():
            warnings.simplefilter("ignore")
            tr.compute_pairwise_all(chain='beta', metric='nw', proceses=1)

        prox_M1 = TCRproximity(tr, 'M1', ['BMLF'], 10, chain='beta', cdrs='cdr3')
        prox_M1.plot_NN_score_distribution()
        res = prox_M1.plot_ROC()

        assert round(res['auc'], 7) == 0.8582996

if __name__ == '__main__':
    unittest.main()